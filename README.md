Алгоритм следующий:
1. Помещаем новые фотки в отдельную папку (photo_dir).
2. Помещаем файлы с табличками экспонатов в другую папку (csv_dir)
3. Для каждой фотки (с расширением JPG) запускаем основной цикл.
4. Создаём временную копию файла фотки в отдельный файл (tmp_file)
5. Выбираем из названия файла фотки идентификатор экспоната
6. Выбираем из названия файла фотки префикс и по нему определяем, в каком файле с табличками нам предстоит искать указанный идентификатор
7. Убираем из лидирующие нули из полученного идентификатора
8. В полученном в пункте 6 файле с табличкой ищем строчку с нужным нам идентификатором (NOM)
9. Если нашли, генерируем новый префикс для будущего названия фотки.
10. Берём из найденной строчки поля с размером объектов (SIZE1 и SIZE2)
11. Если они не пустые, то запускаем алгоритм поиска контуров объектов на фотографии с помощью OpenCV (взят на просторах интернета) в формате прямоугольника. Все найденные контуры помещаются в массив.
12. Выбираем из массива контур с максимальными размерами (т.к. алгоритм часто находит кучу мелких объектов, которые на самом деле являются просто частями основного)
13. Находим максимум из SIZE1 и SIZE2, чтобы сопоставить их с длиной и шириной найденного контура (максимальный размер в сантиметрах из файла с табличкой соответствует максимальной длине грани прямоугольника их файла с фоткой в пикселях)
14. По этому отношению находим, сколько пикселей на конкретно этой фотографии соответствует одному сантиметру.
15. Берём файл с нарисованной заранее линейкой, изменяем её размеры в зависимости от соотношения из предыдущего пункта и лепим изменённую линейку внизу фотки по центру.
16. С помощью полученного в 9 пункте префикса, сохраняем полученную фотку с линейкой в новый файл в отдельную папку (result_folder)
17. Если размеры не были найдены в пункте 10, то пропускаем все пункты с 11 по 16 и сохраняем фотку без нанесённой линейки.
18. Сохраняем описание фотки в отдельный TXT файл (Это попросил сделать Кирилл, чтобы ему было удобно на автомате заливать фотки на сайт с описанием из этого файла в качестве названия фотографии)

Некоторые проблемы алгоритма:
- Он работает нормально в 80% случаев и только при условии, что на фотке монотонный фон. Если экспонат сфотан на неоднородном фоне, то данный алгоритм не сможет выделить объект из фона.
- В новом формате файлов с табличками Михаил Иванович стал вставлять вместо полей SIZE1, SIZE2 и SIZE3 одно поле SIZE, в котором размеры перечислены через разделитель * - например 5,2*4,2*3. Нужно добавить пару строк с разбитием этого параметра на 3 элемента по разделителю. Для старых фоток я использовал старые файлы с табличками, где был размер в старом формате, но сейчас там они посылают новые фотографии, которых нет в старых данных, так что придётся брать их из новых табличек с новым форматом размеров. Новые файлы ещё не отформатированы, придётся с ними немного повозиться.
- Для отладки правильности работы алгоритма я при первом запуске скрипта убирал комментарий со строки - #cv2.drawContours(orig, [box.astype("int")], -1, (0, 255, 0), 2) - и тогда на итоговых изображениях рисуются обнаруженные контуры. Если они адекватно определяют объект, значит алгоритм сработал хорошо. Так можно отделить обработанные фото от необработанных, и потом необработанные подправить в фото редакторе, убрав шум, мешающий работе алгоритма. Это большой геморрой, возможно ты сможешь модифицировать скрипт, чтобы это делалось на автомате.